--- 
Page_title: Service Splitter | Configuration Reference
Description: 
---

# Service Splitter Configuration Reference

This topic describes how to configure service splitter configuration entries. Configure and apply service splitters to redirect a percentage of incoming traffic requests for a specific service. 
## Configuration model

The following list outlines field hierarchy, data types, and requirements in a service splitter configuration entry. Click on a property name to view details about the configuration.

<Tabs>

<Tab heading="HCL" group="hcl">
- [`Kind`](#kind): string | required
- [`Name`](#name): string | required
- [`Namespace`](#namespace): string | optional <Enterprise />
- [`Partition`](#partition): string | optional <Enterprise />
- [`Meta`](#meta): map | optional
- [`Splits`](#splits): map | required
	- [`weight`](#splits-weight): number | required
	- [`Service`](#splits-service): string | required
	- [`ServiceSubset](#splits-servicesubset): string | optional
- [`Namespace`](#splits-namespace): string | optional <Enterprise />
- [`Partition`](#splits-partition): string | optional <Enterprise />
- [`RequestHeaders`](#splits-requestheaders): map | optional
- [`ResponseHeaders`](#splits-responseheaders): map | optional
</Tab>

<Tab heading="YAML" group="yaml">
- [`apiVersion`](#apiVersion): string | required
- [`kind`](#kind): string | required
- [`metadata`](#metadata): object | required
	- [`name`](#name): string | required
	- [`namespace`](#namespace): string | optional <Enterprise />
- [`spec`](#spec): object | required
	- [`splits`](#splits): array | required
		- [`weight`](#splits-weight): float32 | required
		- [`service`](#splits-service): string | required
	- [`serviceSubset`](#splits-servicesubset): string | optional
- [`namespace`](#splits-namespace): string | optional <Enterprise />
- [`partition`](#splits-partition): string | optional <Enterprise />
- [`requestHeaders`](#splits-requestheaders): HTTPHeaderModifiers | optional
- [`responseHeaders`](#splits-responseheaders): HTTPHeaderModifiers | optional

</Tab>
</Tabs>
## Specification

This section provides details about the fields you can configure in a `service-splitter` configuration entry.

<Tabs>

<Tab heading="HCL" group="hcl">
### Kind

Specifies the kind of configuration entry. Must be set to `service-splitter`.
Data type: string 
Default: none
Required: required
### Name

Names the configuration entry in Consul..
Data type: string 
Default: none
Required: required
### Namespace <Enterprise />

Specifies the namespace the configuration entry applies to. 
Data type: string 
Default: none
Required: optional

### Partition <Enterprise />

Specifies the admin partition the configuration entry applies to.
Data type: string 
Default: none
Required: optional

### Meta

Specifies key/value pairs to add to the K/V store.

Data type: map(string:string)
Default: null
Required: optional

### Splits

Defines how much traffic to send to sets of service instances during a traffic split. The sum of weights for a set of service instances must add up to 100. Either [`Splits.service`]#splits-servicesubset) or `[Splits.serviceSubset`](#splits-servicesubset) must be defined to direct split traffic.

Data type: array
Default: null
Required: required

### Splits.weight

A value between 0 and 100 representing a percentage of the total traffic to direct for the traffic split. The smallest representable weight is 1/10000 or .01%.

Data type: float32
Default: 0
Required: required

### Splits.service

The service the split traffic should resolve to.

Data type: string
Default: “”
Required: optional

### Splits.serviceSubset

The named subset of the given service to resolve instead of one defined as that service's `DefaultSubset`. The default subset is used when this field is empty.

Data type: string
Default: “”
Required: optional

### Splits.namespace <Enterprise />

The namespace that the traffic split takes effects in. If empty, the current namespace is used.

Data type: string
Default: “”
Required: optional

### Splits.partition <Enterprise />

The admin partition that the traffic split takes effects in. If empty, the current partition is used.

Data type: string
Default: “”
Required: optional

### Splits.requestHeaders

A set of HTTP-specific header modification rules that apply to requests routed to this split. This field cannot be used with a tcp listener.

Data type: HTTPHeaderModifiers
Default: “”
Required: optional

### Splits.responseHeaders

A set of HTTP-specific header modification rules that apply to responses from this split. This field cannot be used with a tcp listener.

Data type: HTTPHeaderModifiers
Default: “”
Required: optional

</Tab>

<Tab heading="YAML" group="yaml">

### apiVersion

Use this space to thoroughly, but succinctly, document the configuration item. This format is intended to allow you to create complete documentation, however, _stay within the scope of the reference_. If the description deviates from the reference material, create a new Concept topic or add the information to an existing Concept.     

### kind

Add your description. You can include example configurations and describe any dependencies or cascading effects that the configuration may have. 

### metadata

Kubernetes-only object that contains the service name, namespace, and admin partition that the configuration entry applies to. 

### metadata.name

Specifies the name of the service to configure.
Data type: string 
Default: none
Required: required

### metadata.namespace <Enterprise />

Specifies the namespace the configuration entry applies to. 
Data type: string 
Default: none
Required: optional

### spec

Kubernetes-only object that contains the details about the `service-defaults` configuration entry. The `apiVersion`, `kind`, and `metadata` fields are siblings of the `spec` field. All other configurations are children.   

### spec.splits

Defines how much traffic to send to sets of service instances during a traffic split. The sum of weights for a set of service instances must add up to 100. Either [`Splits.service`]#splits-servicesubset) or `[Splits.serviceSubset`](#splits-servicesubset) must be defined to direct split traffic.

Data type: array
Default: null
Required: required

### spec.splits.weight

A value between 0 and 100 representing a percentage of the total traffic to direct for the traffic split. The smallest representable weight is 1/10000 or .01%.

Data type: float32
Default: 0
Required: required

### spec.splits.service

The service the split traffic should resolve to.

Data type: string
Default: “”
Required: optional

### spec.splits.serviceSubset

The named subset of the given service to resolve instead of one defined as that service's `DefaultSubset`. The default subset is used when this field is empty.

Data type: string
Default: “”
Required: optional

### spec.splits.namespace <Enterprise />

The namespace that the traffic split takes effects in. If empty, the current namespace is used.

Data type: string
Default: “”
Required: optional

### spec.splits.partition <Enterprise />

The admin partition that the traffic split takes effects in. If empty, the current partition is used.

Data type: string
Default: “”
Required: optional

### spec.splits.requestHeaders

A set of HTTP-specific header modification rules that apply to requests routed to this split. This field cannot be used with a tcp listener.

Data type: HTTPHeaderModifiers
Default: “”
Required: optional

### spec.splits.responseHeaders

A set of HTTP-specific header modification rules that apply to responses from this split. This field cannot be used with a tcp listener.

Data type: HTTPHeaderModifiers
Default: “”
Required: optional

</Tab>
</Tabs>

## Examples

The examples in this section demonstrate common configurations for `service-splitter` configuration entries. When every field is utilized, a `service-splitter` configuration entry takes the following form:

Kind      = "service-splitter"           ## string  | required
Name      = “name”                       ## string  | required
Namespace = “namespace”                  ## string
Partition = “partition”                  ## string 
Meta      = {                            ## map
  key         = "value"
  answer      = 42
            }
Splits = [                               ## list    | required
  {                                      ## map     
    Weight        = 90                   ## number  | required
    Service       = “service”            ## string     
    ServiceSubset = "v1"                 ## string
    Namespace     = “target-namespace”   ## string
    Partition     = “target-partition”   ## string
    RequestHeaders {                     ## map
      Set {
        "X-Web-Version": "from-v1"
          }
     }
    ResponseHeaders {                    ## map
      Set {
        "X-Web-Version": "to-v1"
          }
    }
  },
  {
    Weight        = 10            
    Service       = “service”    
    ServiceSubset = "v2"          
    Namespace     = “target-namespace”  
    Partition     = “target-partition”  
    RequestHeaders {
      Set {
        "X-Web-Version": "from-v2"
          }
     }
    ResponseHeaders {
      Set {
        "X-Web-Version": "to-v2"
  },
]


### Two subsets of same service

Split traffic between two subsets of the same service:

<CodeTabs tabs={[ "HCL", "Kubernetes YAML", "JSON" ]}>

```hcl
Kind = "service-splitter"
Name = "web"
Splits = [
  {
    Weight        = 90
    ServiceSubset = "v1"
  },
  {
    Weight        = 10
    ServiceSubset = "v2"
  },
]
```

```yaml
apiVersion: consul.hashicorp.com/v1alpha1
kind: ServiceSplitter
metadata:
  name: web
spec:
  splits:
    - weight: 90
      serviceSubset: v1
    - weight: 10
      serviceSubset: v2
```

```json
{
  "Kind": "service-splitter",
  "Name": "web",
  "Splits": [
    {
      "Weight": 90,
      "ServiceSubset": "v1"
    },
    {
      "Weight": 10,
      "ServiceSubset": "v2"
    }
  ]
}
```

</CodeTabs>

### Two different services

Split traffic between two services:

<CodeTabs tabs={[ "HCL", "Kubernetes YAML", "JSON" ]}>

```hcl
Kind = "service-splitter"
Name = "web"
Splits = [
  {
    Weight  = 50
    # will default to service with same name as config entry ("web")
  },
  {
    Weight  = 50
    Service = "web-rewrite"
  },
]
```

```yaml
apiVersion: consul.hashicorp.com/v1alpha1
kind: ServiceSplitter
metadata:
  name: web
spec:
  splits:
    - weight: 50
      # will default to service with same name as config entry ("web")
    - weight: 50
      service: web-rewrite
```

```json
{
  "Kind": "service-splitter",
  "Name": "web",
  "Splits": [
    {
      "Weight": 50
    },
    {
      "Weight": 50,
      "Service": "web-rewrite"
    }
  ]
}
```

</CodeTabs>

### Set HTTP Headers

Split traffic between two subsets with extra headers added so clients can tell
which version:

<CodeTabs tabs={[ "HCL", "Kubernetes YAML", "JSON" ]}>

```hcl
Kind = "service-splitter"
Name = "web"
Splits = [
  {
    Weight        = 90
    ServiceSubset = "v1"
    ResponseHeaders {
      Set {
        "X-Web-Version": "v1"
      }
    }
  },
  {
    Weight        = 10
    ServiceSubset = "v2"
    ResponseHeaders {
      Set {
        "X-Web-Version": "v2"
      }
    }
  },
]
```

```yaml
apiVersion: consul.hashicorp.com/v1alpha1
kind: ServiceSplitter
metadata:
  name: web
spec:
  splits:
    - weight: 90
      serviceSubset: v1
      responseHeaders:
        set:
          x-web-version: v1
    - weight: 10
      serviceSubset: v2
      responseHeaders:
        set:
          x-web-version: v2
```

```json
{
  "Kind": "service-splitter",
  "Name": "web",
  "Splits": [
    {
      "Weight": 90,
      "ServiceSubset": "v1",
      "ResponseHeaders": {
        "Set": {
          "X-Web-Version": "v1"
        }
      }
    },
    {
      "Weight": 10,
      "ServiceSubset": "v2",
      "ResponseHeaders": {
        "Set": {
          "X-Web-Version": "v2"
        }
      }
    }
  ]
}
```

</CodeTabs>

